# 📊 Google Apps Script (GAS) を利用した血圧測定データ管理システム

## 目的と価値

本システムは、日々の血圧測定データを**究極にシンプルに管理・分析・共有**するために開発されました。

### 1. 究極のデータ入力と管理

* **音声入力との連携**: **GeminiやGoogle Keep**などの音声入力機能を利用して血圧の記録をテキストで保存し、そのデータを**クリップボード経由でコピー＆ペースト**するだけで、このスプレッドシートにデータを取り込むことができます。
* **手間からの解放**: コピー＆ペーストされたデータを自動で整形、重複排除、月別シートへの自動分割までを処理します。

### 2. 長期的な健康管理と医師との連携

* **長期推移のグラフ化**: 1ヶ月、3ヶ月、6ヶ月、1年といった期間の血圧推移グラフを**別の専用スプレッドシートに自動生成**します。
* **簡単共有と分析**: 生成されたグラフは、**LINEでの送付**により、**かかりつけ医と簡単に共有**し、長期的な健康状態の分析に役立てることができます。

---

## 📺 参考 YouTube 動画

本システムの具体的な設定方法や実演については、以下の動画をご覧ください。

* **[シニア世代必見！！血圧記録は声に出すだけ！医者もびっくりする血圧推移グラフを家族に自動共有する方法](https://youtu.be/1sRDDI1-Wf4)**

---

## 概要

本プロジェクトは、Google スプレッドシートと Google Apps Script (GAS) を活用し、血圧測定データを効率的に管理・分析するための自動化システムです。クリップボードから貼り付けたCSV形式のデータを自動で整形し、月別シートへの分割、長期推移グラフの自動生成、および複数ユーザーの個人データ管理（子シート作成・削除）を可能にします。

---

## 🚀 一般ユーザー向け利用ガイド

### 1. テンプレートスプレッドシートのコピー

1. **テンプレートを開く**: 以下のリンクから、血圧測定データ管理システムの公開テンプレートを開いてください。
* [テンプレートスプレッドシートへのリンク](https://docs.google.com/spreadsheets/d/14IbWtAM5x2mXj9Z3FrzflUtUx8eI1Ip-wKAJFAO2rUg/edit?usp=sharing)


2. **ご自身のドライブにコピー**: テンプレートが開いたら、メニューバーから `ファイル` > `コピーを作成` を選択します。
3. **コピーの保存**: ファイル名は変更せず（例：「○○のコピー」のまま）、「OK」ボタンを押して保存します。このコピーされたスプレッドシートが、あなたの個人用管理簿となります。

### 2. 初期設定とメニューの確認

1. **シートのリロード**: コピーしたスプレッドシートを開き直し、ページをリロードします。
2. **カスタムメニューの確認**: メニューバーに「**⚙️ 血圧データ処理**」というカスタムメニューが追加されていることを確認します。
3. **使用者名の設定とファイル名の更新**: `血圧データ処理` > `使用者名を変更する` を選択します。
* ポップアップに**使用者名**を入力し、「設定/変更」を押します。


4. **実行権限の承認**: 初回実行時、Googleアカウントへのアクセス許可（DriveApp権限など）を求める承認プロセスが発生します。画面の指示に従って全ての権限を承認してください。

### 3. 血圧データの記録準備（カスタムGemの設定）

この手順は、PC操作に慣れているご家族（PC担当者）が、血圧を測る方のスマートフォン（以下、親族スマホ）を設定するためのガイドです。

#### **ステップ1：記録用メモの作成と共有（親族スマホ）**

1. **メモの自動作成**: 親族スマホでGeminiを起動し、以下のように発声します。
* 例：「**（お名前）さんの血圧記録するメモをKeepに作成**」


2. **共同編集者の追加**: すぐにKeepアプリに移動し、作成された「（お名前）さんの血圧記録」メモを開きます。
3. **アカウント共有**: メモのメニューから、**PC担当者（あなた）のGoogleアカウント**を共同編集者として登録します。

#### **ステップ2：設定テキストの準備（ご自身PC）**

1. **Keepを開く**: PCでGoogle Keepを開き、共有された「（お名前）さんの血圧記録」メモを選択します。
2. **指示テキストの貼り付け**: 以下の【Geminiカスタム指示 設定用テキスト】をコピーして、メモ内に一時的にペーストします。
3. **名前の書き換え**: メモ内の「**（ここにお名前を入力）**」となっている箇所を、すべて血圧を測る方のお名前に書き換えてください。

**【Geminiカスタム指示 設定用テキスト】**

（ここにお名前を入力）さんの血圧記録 記録ルール：
Google Keepの「（ここにお名前を入力）さんの血圧記録」メモにデータを記録せよ。

「動作ルール」

1. 数値を受け取ったら、必ず以下の「スペースで区切った1行のテキスト」を作成すること。
（ここにお名前を入力）さんの血圧記録 YYYY年MM月DD日,HH時mm分,最高血圧,最低血圧,脈拍
2. 上記をメモの末尾に「追記」せよ。
3. 完了報告は、実際に記録した内容を含めて以下の文言のみとすること。アドバイスや余計な会話は一切禁止する。
「記録しました：作成した1行のテキスト」

#### **ステップ3：専用AI「血圧記録係」の作成（親族スマホ）**

1. **テキストのコピー**: 親族スマホでKeepアプリを開き、編集された「設定用テキスト」全体をコピーします。
2. **Gemの作成**: Geminiを起動し、メニューにある「**Gemを表示**」をタップし、「**＋ Gemを作成**」を選んでください。
* **Gemの名前**: 「**血圧記録係**」
* **カスタム指示**: コピーしたテキスト全体をペーストします。


3. **保存**: 画面右上の「**保存**」をタップして完了です。

#### **ステップ4：メモの最終仕上げ（ご自身PC）**

1. **メモのクリア**: PCで共有メモを開き、一時的に貼り付けていたテキストを**すべて削除し、メモを空の状態**にしてください。

### 4. 日々の記録とデータ処理

1. **日々の記録**: 親族スマホでGem「**血圧記録係**」を選択し、「130の85」などと話しかけるだけです。
2. **データ処理**: 定期的にPCでKeepメモの記録をコピーし、スプレッドシートのメニュー `血圧データ処理` > `データ処理を実行（クリップボード入力）` から貼り付けます。
3. **後片付け（重要）**: 処理が完了したら、Keepメモの内容を**「すべて削除」**して空にしてください。

### 5. グラフの確認とLINE共有

1. **グラフシートを開く**: スプレッドシート内の「血圧管理情報」にあるリンクをクリックします。
2. **LINE送付**: スマートフォンのスプレッドシートアプリからグラフを開き、LINEで医師や家族へ共有します。

### 6. 複数ユーザー管理機能

1. **子シートの作成**: `血圧データ処理` > `新たな個人データ管理を作成` を選択します。
2. **子シートの削除**: `血圧データ処理` > `個人シートを削除` を選択します。

---

## 🛠️ 開発者向けセットアップ手順

### 1. スプレッドシートへのコードの導入

1. Google Driveで新規スプレッドシートを作成し、デフォルトシートの名前を **「血圧測定データ」** に書き換えます。
2. `拡張機能` > `Apps Script` を開き、既存のコードを削除して本システムのソースコードを貼り付けます。
3. `input.html` を新規作成し、同様に内容を貼り付けて保存します。

### 2. 初期デプロイと権限の承認

1. シートをリロードし、メニューから `血圧データ処理` > `使用者名を変更する` を実行します。
2. 初回実行時、画面の指示に従って全ての権限承認を行ってください。
